<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Alenstream ‚Äî Remote Upload</title>
  <link rel="icon" type="image/png" href="/image/logo.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f8f9fa; color: #111; }
    .topbar { background: #fff; padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #ddd; }
    .logo { font-weight: bold; font-size: 1.4em; }
    .logo .alena { color: #0d6efd; }
    .logo .stream { color: #333; }
    .navbar { background: #e9f2ff; display: flex; justify-content: center; padding: 12px 0; gap: 40px; border-bottom: 2px solid #cce0ff; }
    .nav-item { text-align: center; color: #0d6efd; font-size: 0.95em; text-decoration: none; display: flex; align-items: center; gap: 6px; position: relative; }
    .nav-item.active { color: #0045a5; font-weight: bold; }
    .nav-item.active::after { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: #0045a5; border-radius: 50%; }
    .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    h2 { color: #111; font-size: 20px; margin-bottom: 20px; }
    
    .card { padding: 20px; border-radius: 12px; background: #fff; border: 1px solid #e5e7eb; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    textarea { width: 100%; min-height: 150px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; resize: vertical; }
    button { padding: 10px 16px; border: none; border-radius: 8px; background: #0d6efd; color: #fff; font-size: 14px; cursor: pointer; margin-top: 10px; transition: background 0.2s; }
    button:hover { background: #0045a5; }
    ul { margin-top: 12px; font-size: 14px; padding-left: 18px; }
    li.success { color: #16a34a; }
    li.error { color: #dc2626; }
    /* Dropdown User */
    .dropdown { position: relative; display: inline-block; }
    .dropbtn { background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 15px; color: #333; }
    .dropbtn i { font-size: 1.2em; color: #555; }
    .dropdown-content { display: none; position: absolute; right: 0; margin-top: 8px; background: #fff; min-width: 160px; box-shadow: 0 2px 6px rgba(0,0,0,0.15); border-radius: 8px; z-index: 10; }
    .dropdown-content a { display: block; padding: 10px; color: #333; text-decoration: none; font-size: 14px; }
    .dropdown-content a:hover { background: #f5f5f5; }
    .dropdown-content a#btnLogout { color: #dc2626; }
    .dropdown.show .dropdown-content { display: block; }
  </style>
</head>
<body>

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="logo"><span class="alena">ALENA</span><span class="stream">STREAM</span></div>
    <div class="user-info">
      <div class="dropdown">
        <button class="dropbtn" id="userBtn">
          <i class="fas fa-user-circle"></i>
          <span id="username"><%= user?.username %></span>
          <i class="fas fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
          <a href="/settings"><i class="fas fa-cog"></i> Settings</a>
          <a href="#" id="btnLogout"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- NAVBAR -->
  <div class="navbar">
    <a href="/dashboard" class="nav-item"><i class="fas fa-chart-line"></i> Dashboard</a>
    <a href="/videos" class="nav-item"><i class="fas fa-video"></i> My Video</a>
    <a href="/remote" class="nav-item active"><i class="fas fa-cloud-upload-alt"></i> Remote Upload</a>
    <a href="/upload" class="nav-item"><i class="fas fa-upload"></i> Upload Video</a>
  </div>

  <!-- CONTENT -->
  <div class="container">
    <div class="card">
      <h2>üì§ Remote Upload (Multi-Link)</h2>
      <form id="remoteForm">
        <label>Masukkan Link Video (satu per baris)</label>
        <textarea id="sourceUrls" placeholder="https://domain/xxx.mp4/m3u8
https://dood.to/abc
https://sm.luxsmab.com/id123"></textarea>
        <button type="submit"><i class="fas fa-plus"></i> Tambahkan</button>
      </form>
      <ul id="remoteResults"></ul>
    </div>
  </div>

  <!-- SCRIPT -->
  <script type="module">
    const form = document.getElementById("remoteForm");
    const textarea = document.getElementById("sourceUrls");
    const results = document.getElementById("remoteResults");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      results.innerHTML = "";

      const urls = textarea.value.split("\n").map(u => u.trim()).filter(Boolean);
      if (!urls.length) {
        alert("Masukkan minimal 1 URL.");
        return;
      }

      for (const url of urls) {
        let title = url;
        try {
          const u = new URL(url);
          title = u.hostname + " " + (u.pathname.split("/").pop() || "");
        } catch {}

        try {
          const res = await fetch("/api/videos/remote", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({ title, sourceUrl: url })
          });
          const json = await res.json();
          if (json.success) {
            results.innerHTML += `<li class="success">‚úÖ ${url} ‚Üí Berhasil ditambahkan</li>`;
          } else {
            results.innerHTML += `<li class="error">‚ùå ${url} ‚Üí ${json.error || "Gagal"}</li>`;
          }
        } catch (err) {
          results.innerHTML += `<li class="error">‚ùå ${url} ‚Üí Error server</li>`;
        }
      }

      textarea.value = "";
    });

    // Dropdown toggle
    document.getElementById("userBtn").addEventListener("click", () => {
      document.querySelector(".dropdown").classList.toggle("show");
    });

    // Logout
    document.getElementById("btnLogout").addEventListener("click", async (e) => {
      e.preventDefault();
      await fetch("/api/auth/logout", { method: "POST", credentials: "include" });
      location.href = "/";
    });
  </script>
</body>
</html>
